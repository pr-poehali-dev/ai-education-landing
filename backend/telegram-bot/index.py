import json
import os
from typing import Dict, Any

def handler(event: Dict[str, Any], context: Any) -> Dict[str, Any]:
    '''
    –¢–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç –¥–ª—è —à–∫–æ–ª—ã –Ω–µ–π—Ä–æ—Å–µ—Ç–µ–π "–•–∞–∫–Ω–∏"
    –û—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –æ –∫—É—Ä—Å–µ: —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, —Ü–µ–Ω—ã, –ø—Ä–æ–≥—Ä–∞–º–º–∞, –º–µ—Å—Ç–∞
    '''
    method: str = event.get('httpMethod', 'POST')
    
    if method == 'OPTIONS':
        return {
            'statusCode': 200,
            'headers': {
                'Access-Control-Allow-Origin': '*',
                'Access-Control-Allow-Methods': 'POST, OPTIONS',
                'Access-Control-Allow-Headers': 'Content-Type',
                'Access-Control-Max-Age': '86400'
            },
            'body': '',
            'isBase64Encoded': False
        }
    
    if method != 'POST':
        return {
            'statusCode': 405,
            'headers': {'Content-Type': 'application/json'},
            'body': json.dumps({'error': 'Method not allowed'}),
            'isBase64Encoded': False
        }
    
    try:
        update = json.loads(event.get('body', '{}'))
        
        if 'message' not in update:
            return {'statusCode': 200, 'body': json.dumps({'ok': True}), 'isBase64Encoded': False}
        
        message = update['message']
        chat_id = message['chat']['id']
        text = message.get('text', '').lower().strip()
        
        response_text = get_response(text)
        
        send_message(chat_id, response_text)
        
        return {
            'statusCode': 200,
            'headers': {'Content-Type': 'application/json'},
            'body': json.dumps({'ok': True}),
            'isBase64Encoded': False
        }
    
    except Exception as e:
        return {
            'statusCode': 500,
            'headers': {'Content-Type': 'application/json'},
            'body': json.dumps({'error': str(e)}),
            'isBase64Encoded': False
        }


def get_response(text: str) -> str:
    '''–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–∫—Å—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è'''
    
    if any(word in text for word in ['/start', '–ø—Ä–∏–≤–µ—Ç', '–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π', '–Ω–∞—á–∞—Ç—å']):
        return '''üëã –ü—Ä–∏–≤–µ—Ç! –Ø –±–æ—Ç —à–∫–æ–ª—ã –Ω–µ–π—Ä–æ—Å–µ—Ç–µ–π "–•–∞–∫–Ω–∏"!

–ú–æ–≥—É —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å —Ç–µ–±–µ –æ:
üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–∏ –∫—É—Ä—Å–∞
üí∞ –¶–µ–Ω–∞—Ö –∏ —Ç–∞—Ä–∏—Ñ–∞—Ö
üìö –ü—Ä–æ–≥—Ä–∞–º–º–µ –æ–±—É—á–µ–Ω–∏—è
üë• –ö–æ–ª–∏—á–µ—Å—Ç–≤–µ –º–µ—Å—Ç
üìç –ê–¥—Ä–µ—Å–µ —à–∫–æ–ª—ã

–ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏, —á—Ç–æ —Ç–µ–±—è –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç!'''
    
    if any(word in text for word in ['—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ', '–∫–æ–≥–¥–∞', '–≤—Ä–µ–º—è', '–¥–∞—Ç–∞', '—Å—Ç–∞—Ä—Ç']):
        return '''üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∫—É—Ä—Å–∞:

üöÄ –°—Ç–∞—Ä—Ç: 16 —Ñ–µ–≤—Ä–∞–ª—è 2026 –≥–æ–¥–∞

üìÜ –í—Å—Ç—Ä–µ—á–∏: 2 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é
‚Ä¢ –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫: 17:00 - 20:00
‚Ä¢ –ß–µ—Ç–≤–µ—Ä–≥: 17:00 - 20:00

üìä –û–±—ä—ë–º:
‚Ä¢ 24 –≤—Å—Ç—Ä–µ—á–∏
‚Ä¢ 3 —á–∞—Å–∞ –∫–∞–∂–¥–∞—è
‚Ä¢ –ò—Ç–æ–≥–æ: 72 —á–∞—Å–∞ –æ–±—É—á–µ–Ω–∏—è'''
    
    if any(word in text for word in ['—Ü–µ–Ω–∞', '—Ü–µ–Ω—ã', '—Å—Ç–æ–∏–º–æ—Å—Ç—å', '—Ç–∞—Ä–∏—Ñ', '—Å–∫–æ–ª—å–∫–æ']):
        return '''üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å –æ–±—É—á–µ–Ω–∏—è:

üì¶ –ë–ê–ó–ê - 99,000‚ÇΩ
‚úÖ –ì—Ä—É–ø–ø–æ–≤–æ–µ –æ–±—É—á–µ–Ω–∏–µ
‚úÖ –í—Å–µ –±–∞–∑–æ–≤—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
‚úÖ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è
‚úÖ –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç

üë§ –ò–ù–î–ò–í–ò–î–£–ê–õ–¨–ù–´–ô - 299,000‚ÇΩ
‚úÖ –í—Å—ë –∏–∑ —Ç–∞—Ä–∏—Ñ–∞ "–ë–∞–∑–∞"
‚úÖ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫
‚úÖ –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫
‚úÖ –ü—Ä–æ–µ–∫—Ç –ø–æ–¥ –∫–ª—é—á

–û–ø–ª–∞—Ç–∞ –≤–æ–∑–º–æ–∂–Ω–∞ —á–∞—Å—Ç—è–º–∏!'''
    
    if any(word in text for word in ['–ø—Ä–æ–≥—Ä–∞–º–º–∞', '–æ–±—É—á–µ–Ω–∏–µ', '—á–µ–º—É', '–Ω–∞—É—á—É', '–∫—É—Ä—Å', '—á—Ç–æ –∏–∑—É—á–∏–º']):
        return '''üìö –ü—Ä–æ–≥—Ä–∞–º–º–∞ –∫—É—Ä—Å–∞:

ü§ñ –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏
‚Ä¢ ChatGPT, Claude, Gemini
‚Ä¢ Midjourney, DALL-E, Stable Diffusion

üíº –ë–∏–∑–Ω–µ—Å-–ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ
‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
‚Ä¢ –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
‚Ä¢ –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö

üõ†Ô∏è –ü—Ä–∞–∫—Ç–∏–∫–∞
‚Ä¢ –†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã
‚Ä¢ –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è
‚Ä¢ –ö–æ–º–∞–Ω–¥–Ω–∞—è —Ä–∞–±–æ—Ç–∞

üìà –†–µ–∑—É–ª—å—Ç–∞—Ç
‚Ä¢ –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
‚Ä¢ –ù–æ–≤—ã–µ –Ω–∞–≤—ã–∫–∏
‚Ä¢ –ì–æ—Ç–æ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è –¥–ª—è —Ä–∞–±–æ—Ç—ã'''
    
    if any(word in text for word in ['–º–µ—Å—Ç', '–º–µ—Å—Ç–∞', '—Å–≤–æ–±–æ–¥–Ω', '–∑–∞–ø–∏—Å—å', '–∑–∞–ø–∏—Å–∞—Ç—å—Å—è']):
        return '''üë• –ú–µ—Å—Ç–∞ –Ω–∞ –∫—É—Ä—Å–µ:

–í—Å–µ–≥–æ –º–µ—Å—Ç: 15
‚è∞ –ù–∞–±–æ—Ä –æ—Ç–∫—Ä—ã—Ç!

üìù –ö–∞–∫ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è:
1. –í—ã–±–µ—Ä–∏ —Ç–∞—Ä–∏—Ñ (–ë–ê–ó–ê –∏–ª–∏ –ò–ù–î–ò–í–ò–î–£–ê–õ–¨–ù–´–ô)
2. –û—Å—Ç–∞–≤—å –∑–∞—è–≤–∫—É –Ω–∞ —Å–∞–π—Ç–µ
3. –ú–µ–Ω–µ–¥–∂–µ—Ä —Å–≤—è–∂–µ—Ç—Å—è —Å —Ç–æ–±–æ–π

üí¨ –û—Å—Ç–∞–ª–∏—Å—å –≤–æ–ø—Ä–æ—Å—ã?
Telegram: @hackni_support
WhatsApp: +7 (XXX) XXX-XX-XX'''
    
    if any(word in text for word in ['–∞–¥—Ä–µ—Å', '–≥–¥–µ', '–º–µ—Å—Ç–æ', '–ª–æ–∫–∞—Ü–∏—è', '–Ω–∞—Ö–æ–¥–∏—Ç—Å—è']):
        return '''üìç –ê–¥—Ä–µ—Å —à–∫–æ–ª—ã:

—É–ª. –†—É—Å—Å–∫–∞—è 41–∞
3 —ç—Ç–∞–∂, –æ—Ñ–∏—Å "–•–∞–∫–Ω–∏ –ù–µ–π—Ä–æ—Å–µ—Ç–∏"

üó∫Ô∏è –ö–∞–∫ –¥–æ–±—Ä–∞—Ç—å—Å—è:
–£–¥–æ–±–Ω–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –≤ —Ü–µ–Ω—Ç—Ä–µ
–†—è–¥–æ–º –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞

üÖøÔ∏è –ü–∞—Ä–∫–æ–≤–∫–∞: –µ—Å—Ç—å

üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã:
Telegram: @hackni_support
–°–∞–π—Ç: –≤–∞—à-—Å–∞–π—Ç.ru'''
    
    if any(word in text for word in ['–∫–æ–Ω—Ç–∞–∫—Ç', '—Å–≤—è–∑—å', '—Ç–µ–ª–µ—Ñ–æ–Ω', '–Ω–∞–ø–∏—Å–∞—Ç—å']):
        return '''üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã:

üí¨ Telegram: @hackni_support
üì± WhatsApp: +7 (XXX) XXX-XX-XX
üåê –°–∞–π—Ç: –≤–∞—à-—Å–∞–π—Ç.ru
üìß Email: info@hackni-neuro.ru

‚è∞ –†–∞–±–æ—Ç–∞–µ–º:
–ü–Ω-–ü—Ç: 10:00 - 19:00
–°–±-–í—Å: –ø–æ –∑–∞–ø–∏—Å–∏'''
    
    return '''–ù–µ —Å–æ–≤—Å–µ–º –ø–æ–Ω—è–ª —Ç–≤–æ–π –≤–æ–ø—Ä–æ—Å ü§î

–ú–æ–≥—É —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –æ:
üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–∏ –∫—É—Ä—Å–∞
üí∞ –¶–µ–Ω–∞—Ö –∏ —Ç–∞—Ä–∏—Ñ–∞—Ö
üìö –ü—Ä–æ–≥—Ä–∞–º–º–µ –æ–±—É—á–µ–Ω–∏—è
üë• –ö–æ–ª–∏—á–µ—Å—Ç–≤–µ –º–µ—Å—Ç
üìç –ê–¥—Ä–µ—Å–µ —à–∫–æ–ª—ã
üìû –ö–æ–Ω—Ç–∞–∫—Ç–∞—Ö

–ù–∞–ø–∏—à–∏, —á—Ç–æ —Ç–µ–±—è –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç!'''


def send_message(chat_id: int, text: str) -> None:
    '''–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram'''
    import urllib.request
    import urllib.parse
    
    token = os.environ.get('TELEGRAM_BOT_TOKEN')
    if not token:
        raise ValueError('TELEGRAM_BOT_TOKEN not set')
    
    url = f'https://api.telegram.org/bot{token}/sendMessage'
    
    data = urllib.parse.urlencode({
        'chat_id': chat_id,
        'text': text,
        'parse_mode': 'HTML'
    }).encode('utf-8')
    
    req = urllib.request.Request(url, data=data, method='POST')
    urllib.request.urlopen(req)
